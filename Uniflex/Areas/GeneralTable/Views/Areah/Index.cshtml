@{
    ViewBag.Title = "Area";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/Content/DataTables/datatables.css" />
    <link rel="stylesheet" href="~/Content/DataTables/DataTables-1.10.25/css/dataTables.bootstrap5.min.css" type="text/css">
    <link rel="stylesheet" href="~/Content/Select2/css/select2.min.css" type="text/css" />
    <link rel="stylesheet" href="~/Content/flatpickr/flatpickr.min.css" type="text/css" />
    <link rel="stylesheet" href="~/adminlte/plugins/jquery-ui/jquery-ui.min.css" type="text/css" />
    <link rel="stylesheet" href="~/Content/flatpickr/plugins/monthSelect/style.css" type="text/css" />
    <link href="~/adminlte/plugins/toastr/toastr.min.css" rel="stylesheet" type="text/css" />
    <link href="~/adminlte/plugins/sweetalert2/sweetalert2.css" rel="stylesheet" />
    <style type="text/css">
        td.details-control {
            background: url("@Url.Content("~/Images/Default/details_open.png")") no-repeat center center;
        }

        tr.shown td.details-control {
             background: url("@Url.Content("~/Images/Default/details_close.png")") no-repeat center center;
        }
    </style>
}

<section class="content">
    <div class="container-fluid">
        <div class="row mb-1">
            <section class="col-lg-12 p-0">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <b>Zona Area</b>
                        </h3>
                    </div>
                    <div class="card-body">
                        <div id="sortable" class="row">
                            <section class="col-lg-5 connectedSortable">
                                <div class="card" style="cursor:move;">
                                    <div class="card-header">
                                        <p class="card-title text-sm text-left">Input Data Zona (Area)</p>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group row mb-1">
                                            <label for="txtAreaName" class="col-sm-2 control-label">A.Name</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="txtAreaName" class="form-control form-control-sm" required />
                                            </div>
                                        </div>
                                        <div class="form-group row mb-1">
                                            <label for="txtAreaId" class="col-sm-2 control-label">Area Id</label>
                                            <div class="col-sm-10">
                                                <input type="text" id="txtAreaId" class="form-control form-control-sm" required />
                                            </div>
                                        </div>
                                        <div class="form-group row mb-1">
                                            <label for="txtAreaDesc" class="col-sm-2 control-label">Desc</label>
                                            <div class="col-sm-10">
                                                <textarea id="txtAreaDesc" class="form-control form-control-sm" required rows="5"></textarea>
                                            </div>
                                        </div>
                                        <div class="form-group row mb-1">
                                            <label for="txtAreaStatus" class="col-sm-2 control-label">Status</label>
                                            <div class="col-sm-10">
                                                <select id="txtAreaStatus" class="form-select form-control form-select-sm" required>
                                                    <option value="True" selected>True</option>
                                                    <option value="False">False</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group row mb-1 text-right">
                                            <div class="col-sm-12 text-right">
                                                <a id="btnSaveArea" class="btn btn-sm btn-primary" href="#"><i class="fas fa-save mr-2"></i>Save</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                            <section class="col-lg-7 connectedSortable">
                                <div class="card" style="cursor:move;">
                                    <div class="card-header border-0">
                                        <p class="card-title text-sm">
                                            View Data
                                        </p>
                                        <div class="card-tools">
                                            <ul class="nav nav-pills ml-auto">
                                                <li class="nav-item mr-2">
                                                    <a id="aRefresh1" class="nav-link bg-success" href="#"><i class="fas fa-sync mr-1"></i>Refresh</a>
                                                </li>
                                                <li class="nav-item">
                                                    <a id="aDelete1" class="nav-link bg-red" href="#"><i class="fas fa-trash mr-1"></i>Delete</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive table-responsive-sm p-2 bg-white border">
                                            <table id="tblArea" class="table table-striped table-hover w-100">
                                                <thead>
                                                    <tr>
                                                        <th>#</th>
                                                        @*<th>Row_Id</th>*@
                                                        <th>Area_Name</th>
                                                        <th>Area_Desc</th>
                                                        <th>Area_Id</th>
                                                        @*<th>Area_UserEntry</th>
                                                        <th>Area_UserEntry_Date</th>
                                                        <th>Area_UserUpdate_Date</th>
                                                        <th>Area_status_active</th>*@
                                                    </tr>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div class="row mb-1">
            <button id="btn-test" class="btn btn-primary btn-sm">Test Expand Treeview</button>
        </div>
    </div>
</section>

@section scripts {
    <script src="~/Scripts/moment.min.js"></script>
    <script type="text/javascript" src="~/Content/flatpickr/flatpickr.min.js"></script>
    <script type="text/javascript" src="~/Content/flatpickr/id.min.js"></script>
    <script type="text/javascript" src="~/Content/DataTables/datatables.min.js"></script>
    <script type="text/javascript" src="~/Content/DataTables/DataTables-1.10.25/js/dataTables.bootstrap5.min.js"></script>
    <script type="text/javascript" src="~/Content/Select2/js/select2.full.min.js"></script>
    <script type="text/javascript" src="~/adminlte/plugins/jquery-ui/jquery-ui.min.js"></script>
    <script type="text/javascript" src="~/Content/flatpickr/plugins/monthSelect/Index.js"></script>
    <script type="text/javascript" src="~/adminlte/plugins/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="~/adminlte/plugins/sweetalert2/sweetalert2.js"></script>
    <script type="text/javascript">
        var lbr = null;
        $(document).ready(function () {

            ExpandTreeView_(window.location);

            lbr = Refresh_Table_Area('');

            $("#txtAreaStatus").select2({
                width: "100%", theme: "classic", disableMobile: true
            });

            $("#sortable").sortable();

            $("#aRefresh1").click(function () {
                lbr = Refresh_Table_Area('');
            })

            $("#aDelete1").click(function () {
                console.log("aDelete1");
            })

            $("#btnSaveArea").click(function () {
                SaveAreA();
            })


        })// $(document).ready(function () {

          function Refresh_Table_Area(tglfrom) {
              return $("#tblArea").DataTable({
            bDestroy: true,
            responsive: false,
            processing: true,
            "order": [[1, "asc"]],
            serverSide: true,
            "columnDefs": [
                {
                    "targets": 'no-sort',
                    "orderable": true,
                },
                {
                    "data": null,
                    "width": "20px",
                    "defaultContent": '',
                    "orderable": true,
                    "className": "details-control",
                    "targets": [0]
                }
            ],
            "columns": [
                { "data": null },
                { "data": "Area_Name", "name": "Area_Name" },
                { "data": "Area_Desc", "name": "Area_Desc" },
                { "data": "Area_Id", "name": "Area_Id" }
            ],
            "select": {
                "style": 'multi'
            },
            "language":
            {
                "search": "",
                "searchPlaceholder": "Search...",
                "emptyTable": "No record found.",
                "processing": "<div class='overlay custom-loader-background'><i class='fa fa-spinner fa-spin custom-loader-color' style='font-size:30px;color:rgb(75, 183, 245)'></i></div>"
            },
            "processing": "true",
            "order": [[1, "asc"]],
            "serverSide": "true",
            "lengthMenu": [[1, 10, 20, 50, 100, 1000, -1], [1, 10, 20, 50, 100, 1000, "All"]],
            "pageLength": 10,
            "ajax":
            {
                "url": '@Url.Action("RefreshArea", "Areah", new { Area = "GeneralTable" })',
                "type": "POST",
                "data": { "tglfrom": tglfrom},
                "dataType": "JSON"
            }
        });
        }// Get Data

        function SaveAreA() {
            var txtAreaName = document.getElementById("txtAreaName");
            var txtAreaId = document.getElementById("txtAreaId");
            var txtAreaDesc = document.getElementById("txtAreaDesc");
            var txtAreaStatus = document.getElementById("txtAreaStatus");

            if ($.trim($(txtAreaName).val()) == "") {
                CreateErrorPublic("txtAreaName", "This Empty!");
                return false;
            }
            if ($.trim($(txtAreaId).val()) == "") {
                CreateErrorPublic("txtAreaId", "This Empty!");
                return false;
            }
            if ($.trim($(txtAreaDesc).val()) == "") {
                CreateErrorPublic("txtAreaDesc", "This Empty!");
                return false;
            }

            BtnLoading($("#btnSaveArea"));

            var fd = new FormData();
            fd.append("nama", $("#txtAreaName").val());
            fd.append("id", $("#txtAreaId").val());
            fd.append("desc", $("#txtAreaDesc").val());
            fd.append("stat", $("#txtAreaStatus").val());

            $.ajax({
                    url: '@Url.Action("SaveNewArea", "Areah", new { Area = "GeneralTable" })',
                type: 'post',
                data: fd,
                contentType: false,
                processData: false,
                success: function (x, textStatus, jQxhr) {
                    BtnReset($("#btnSaveArea"));
                    if (x.status === 'success') {
                            lbr = Refresh_Table_Area('');
                         } else {
                            Swal.fire(x.msg, '', 'info');
                         }
                    },
                error: function (jqXhr, textStatus, errorThrown) {
                    BtnReset($("#btnSaveArea"));
                        console.log(errorThrown);
                    }
                });
        }

    </script>
}
